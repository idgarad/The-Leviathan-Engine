
# MinIO Setup Guide (Homelab, Multi-Node, Multi-Disk)

> **Language Notice:** As of October 2025, Rust is the unified backend language for all simulation, orchestration, and infrastructure code in The Leviathan Engine project. All future code examples and integrations will use Rust.

> **Update Notice:** Accurate as of October 2025. For latest info, see official MinIO documentation.
> 
> **For additional information, please see:**
> - MinIO Docs: https://min.io/docs/minio/linux/index.html
> - [Book] "Cloud Native Data Management" by Alex Gorelik
> - [YouTube] Search "MinIO homelab tutorial 2024" for recent guides

---

## Step 1: Plan Your MinIO Deployment

**Tool Explanation:**
MinIO is an open-source, S3-compatible object storage server. It is ideal for storing Terraform state, backups, and other files in a homelab. Multi-node, multi-disk setups provide redundancy and simulate production-grade reliability.

**Role in Infrastructure:**
MinIO acts as the backend for Terraform state and other persistent data, ensuring high availability and easy backup/restore.

**Further Reading & References:**
- [MinIO Multi-Node Setup (YouTube)](https://www.youtube.com/results?search_query=minio+multi+node+setup)
- [Book] "Cloud Native Data Management" by Alex Gorelik

---

## Step 2: Prepare VMs and Disks

1. Create two VMs (e.g., Ubuntu 22.04 LTS) in Proxmox or your virtualization platform.
2. Attach two additional virtual disks to each VM (for MinIO data storage).
3. Assign static IPs for easy cluster setup: `192.168.1.230` and `192.168.1.231` (outside your DHCP pool, assuming 230-256 are outside the pool).
4. Ensure VMs can communicate over the network (same subnet).

> **Teaching Note:** Using separate VMs and disks simulates real-world MinIO clusters and provides fault tolerance.

---

## Step 3: Install MinIO on Each Node

1. SSH into each VM and install MinIO:
   ```bash
   wget https://dl.min.io/server/minio/release/linux-amd64/minio
   chmod +x minio
   sudo mv minio /usr/local/bin/
   minio --version
   ```
2. Create directories for each disk (e.g., `/mnt/disk1`, `/mnt/disk2`). Mount the disks and ensure proper permissions.

---


## Step 4: Configure MinIO Cluster as a systemd Service

**Recommended Practice:**
For production or homelab use, install MinIO as a systemd service so it starts automatically on reboot and is managed like any other service.

1. Create a systemd unit file on each node (e.g., `/etc/systemd/system/minio.service`):
   ```ini
   [Unit]
   Description=MinIO Object Storage
   After=network.target

   [Service]
   Environment="MINIO_ROOT_USER=minioadmin"
   Environment="MINIO_ROOT_PASSWORD=yoursecurepassword"
   ExecStart=/usr/local/bin/minio server \
     http://192.168.1.230/mnt/disk1 http://192.168.1.230/mnt/disk2 \
     http://192.168.1.231/mnt/disk1 http://192.168.1.231/mnt/disk2 \
     --console-address ":9001"
   Restart=always
   LimitNOFILE=65536

   [Install]
   WantedBy=multi-user.target
   ```
2. Reload systemd and enable/start the service:
   ```bash
   sudo systemctl daemon-reload
   sudo systemctl enable minio
   sudo systemctl start minio
   ```
3. MinIO will automatically form a distributed cluster and start on boot.
4. Access the web console at `http://<node-ip>:9001` (login with credentials above).

> **Teaching Note:** Always use strong passwords and restrict network access to trusted hosts. Managing MinIO as a service ensures resilience to reboots and easier administration.

---

## Step 5: Create Buckets for Terraform State

1. Log in to the MinIO web console.
2. Create a bucket named `terraform-state` (or similar).
3. Note the endpoint URL, access key, and secret key for Terraform backend configuration.

---

## Step 6: Backup and Maintenance

- Regularly back up MinIO data directories to another disk or cloud service.
- Monitor cluster health via the web console.
- Test failover by shutting down one node and verifying access from the other.

---

## Troubleshooting & Best Practices

- Use RAID or ZFS for additional disk redundancy if desired.
- Keep MinIO updated for security and stability.
- Document all configuration and credentials.
- Use firewall rules to restrict access to MinIO ports.

---

> **Update Notice:** Instructions accurate as of October 2025. For latest info, see official docs.
> 
> **Further Reading:**
> - https://min.io/docs/minio/linux/index.html
> - "Cloud Native Data Management" by Alex Gorelik
